{"version":3,"sources":["../../src/controller/category.js"],"names":["Category","require","slugify","createCategories","categories","parentId","categoryList","category","filter","cat","undefined","cate","push","_id","name","slug","categoryImage","children","exports","addCategory","req","res","categoryObj","body","file","filename","save","error","status","json","getCategories","find","exec","getCategoryBySlug","params","findOne","select","Product","products","length"],"mappings":"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","file":"category.js","sourcesContent":["const Category = require('../model/category');\r\nconst slugify = require('slugify');\r\n\r\ncreateCategories = (categories, parentId = null) => {\r\n    const categoryList = [];\r\n    let category;\r\n    if(parentId == null){\r\n        category = categories.filter(cat => cat.parentId == undefined);\r\n    } else {\r\n        category = categories.filter(cat => cat.parentId == parentId)\r\n    }\r\n\r\n    for(let cate of category) {\r\n        categoryList.push({\r\n            _id: cate._id,\r\n            name: cate.name,\r\n            slug: cate.slug,\r\n            parentId: cate.parentId,\r\n            categoryImage: cate.categoryImage,\r\n            children: createCategories(categories, cate._id)\r\n        });\r\n    }\r\n\r\n    return categoryList;\r\n}\r\n\r\nexports.addCategory = (req,res) => {\r\n    const categoryObj = {\r\n        name: req.body.name,\r\n        slug: slugify(req.body.name),\r\n    }\r\n\r\n    if(req.file){\r\n        categoryObj.categoryImage = req.file.filename;\r\n    }\r\n\r\n    if (req.body.parentId) {\r\n        categoryObj.parentId = req.body.parentId;\r\n    }\r\n\r\n    const cat = new Category(categoryObj);\r\n    cat.save((error, category) => {\r\n        if(error) return res.status(400).json({error})\r\n        if(category) {\r\n            return res.status(201).json({category});\r\n        }\r\n    })\r\n}\r\n\r\nexports.getCategories = (req,res) => {\r\n    Category.find({})\r\n    .exec((error, categories) => {\r\n        if(error) return res.status(400).json({error})\r\n        \r\n        if (categories) {\r\n            const categoryList = createCategories(categories);\r\n\r\n            res.status(200).json({ categoryList });\r\n        }\r\n\r\n    });\r\n}\r\n\r\nexports.getCategoryBySlug = (req, res) => {\r\n    const { slug } = req.params;\r\n    Category.findOne({ slug: slug})\r\n    .select(\"_id name\")\r\n    .exec((error, category) => {\r\n        if(error){\r\n            return res.status(400).json({error});\r\n        }\r\n        if(category){\r\n            Product.find({ category: category._id })\r\n            .exec((error, products) => {\r\n                if(error){\r\n                    res.status(400).json({error});\r\n                }\r\n                if(products.length > 0){\r\n                    res.status(200).json({\r\n                        products\r\n                    });\r\n                }\r\n                \r\n            })\r\n        }      \r\n    });\r\n}"]}